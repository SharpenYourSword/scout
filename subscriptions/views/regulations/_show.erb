<% regulation = item.data %>

<div class="summary">

  <div class="entryHeader">
    <h2><%= regulation_title regulation %></h2>
    <div class="subtitle">
      <%= agency_names regulation %>
      <br/>
      
      <%= regulation_type regulation %>

      <% if regulation['document_type'] != "public_inspection" %>
        issued on
      <% else %>
        filed for public inspection on
      <% end %>
      <time class="item" datetime="<%= html_date item.date %>">
          <%= just_date_year item.date %>
      </time>
    </div>
  </div>

  <div class="clear"></div>

  <div class="resources">
    <h5>Resources</h5>
    <ul>
      <li class="fedReg">
        <a data-resource="federalregister" target="_blank" href="<%= regulation['url'] %>">Federal Register</a>
      </li>

      <li class="source">
        <% if regulation['pdf_url'] %>
          <a data-resource="original" target="_blank" class="pdf" href="<%= regulation['pdf_url'] %>">
            Original Text (PDF)
          </a>
        <% end %>
      </li>
      </ul>
  </div>
    
  <div class="clear"></div>

  <% if regulation['document_type'] != 'public_inspection' %>
    <% if regulation['abstract'].present? %>
      <%= regulation_abstract regulation %>
    <% else %>
      <p>No abstract available.</p>
    <% end %>
  <% else %>
    <p>
      This is a <strong>pre-release</strong> version of this <%= regulation_type(regulation) %>. It will be formally published on <strong><%= just_date regulation['publication_date'] %></strong> in the Federal Register.
    </p>
    <p>
      Though it is an official document, it can theoretically be withdrawn before formal publication, and some details may not yet be available. <a href="https://www.federalregister.gov/learn/public-inspection-desk-2">Read more about pre-release documents.</a>
    </p>

    <iframe class="document"></iframe>

    <script type="text/javascript">

      function displayDocument(url) {
        if (isFirefox)
          $("iframe").attr("src", url);
        else if (!isIE) {
          // cache-buster for CORS - without this, if someone were to have accessed this PDF first
          // from some other domain, Chrome caches the CORS headers that S3 returned for that other domain,
          // which are invalid for this one. S3's implementation of CORS returns an origin domain header
          // of the specific requesting domain, even if you've configured your bucket to support *.
          url += "?origin=" + window.location.hostname;

          $("iframe").attr("src", "/document?filename=" + encodeURIComponent(url));
        } else // IE, just hide it
          $("iframe").hide();
      }

      var url = $("a.pdf").attr("href");
      if (url) displayDocument(url);

    </script>
  <% end %>
</div>